!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Navigator=e()}(this,(function(){"use strict";const t=t=>"string"==typeof t,e=t=>Object.prototype.toString.apply(t),i=t=>"function"==typeof t||"[object Function]"===e(t),r=t=>("[object Object]"===e(t)||"object"==typeof t||i(t))&&null!==t,s=t=>!!(r(t)&&t.nodeName&&t.tagName&&1===t.nodeType),n=(t,e=300)=>!!i(t)&&setTimeout((()=>{t()}),e),o=t=>Array.isArray?Array.isArray(t):"[object Array]"===e(t),l=t=>{let e={};return null===t?null:(o(t)?e=Array.from(t):(e=Object.assign({},t),Object.keys(e).forEach((i=>e[i]=r(t[i])?l(t[i]):t[i]))),e)},a=["focusout","blur","focusin","focus","load","unload","mouseenter","mouseleave"],h=(t,e,i)=>{const r=a.indexOf(e)>-1;i._delegateListener&&delete(i=i._delegateListener)._delegateListener,function(t,e,i){const r=t._listeners;let s=-1;if(r.length<1)return!1;r.forEach(((t,r)=>{const n=t.fn;e===t.type&&(s=r,n===i&&(s=r))})),s>-1&&r.splice(s,1)}(t,e,i),t.removeEventListener(e,i,r)},c=function(e,i,r=!1){const n=t(e)?document.querySelector(e):e,o=n.childNodes,l=((e,i)=>{let r=e._listeners||[];return t(i)&&i&&(r=r.filter((t=>t.type===i))),r})(n,i);l.forEach((t=>{h(n,t.type,t.fn)})),(r||!0===i||1===arguments.length)&&n&&o&&o.forEach((t=>{s(t)&&c(t,i,r)}))},u=(t,e,r)=>{if(!i(r))return c(t,e),!1;h(t,e,r)},d=(t,e,r,s,n,o=!1)=>{const l=a.indexOf(e)>-1,h=function(i){let l=n||t;!0===n&&(l=s),!0===o&&u(t,e,h),r.call(l,i,s)};if(!i(r))return!1;t._listeners||(t._listeners=[]),t._listeners.push({el:t,type:e,fn:h,data:s,context:n,capture:l}),r._delegateListener=h,t.addEventListener(e,h,l)},f=(t,e="")=>{const i=e.replace(/^>/i,"");return!!(e&&i&&t)&&(t.matches?t.matches(i):!!t.msMatchesSelector&&t.msMatchesSelector(i))},m=t=>t.host&&t!==document&&t.host.nodeType?t.host:t.parentNode,p=(t,e,i,r,s,n,o=!1)=>{const l=a.indexOf(i)>-1,h=function(l){const a=function(t){const e=t.target;return(i=e)&&3===i.nodeType?i.parentNode:i;var i}(l),c=((t,e,i,r)=>{const s=i||document;if(!t)return null;do{if(null!=e&&(e.startsWith(">")?t.parentNode===s&&f(t,e):f(t,e))||r&&t===s)return t;if(t===s)break}while(t=m(t))})(a,e,t);let d=n||t;l.delegateTarget=c,!0===n&&(d=s),c&&(!0===o&&u(t,i,h),r.call(d,l,s))};if(!t)return!1;t._listeners||(t._listeners=[]),t._listeners.push({el:t,selector:e,type:i,fn:h,data:s,context:n,capture:l}),r._delegateListener=h,t.addEventListener(i,h,l)},g=t=>{return!(!r(t)||!(s(t)||(t=>!(!r(t)||"[object NodeList]"!==e(t)))(t)||(i=t,r(i)&&"[object DocumentFragment]"===e(i))||(t=>!(!r(t)||!("[object Text]"===e(t)||t.tagName&&3===t.nodeType)))(t)));var i},y=(t,e)=>{const i=Object.prototype.hasOwnProperty;return t&&i.call(t,e)},v=(t,e)=>{const i=new RegExp("(\\s|^)"+e+"(\\s|$)");let r,n;return!!s(t)&&(r=t.className,!!r&&(n=t.classList,n&&n.contains?t.classList.contains(e):!!i.exec(r)))},b=(t,e)=>{var i;let r,s;if(v(t,e))return!1;r=t.classList,null!==(i=r)&&void 0!==i&&i.add?e.indexOf(" ")>-1?e.split(" ").forEach((t=>{r.add(t)})):r.add(e):(s=t.className,s+=s.length>0?" "+e:e,t.className=s)},$=(t,e)=>{if(!t||!r(e))return!1;Object.keys(e).forEach((i=>{const r=e[i];y(e,i)&&((t,e,i)=>{let r=t.tagName.toLowerCase();switch(e){case"style":t.style.cssText=i;break;case"value":"input"===r||"textarea"===r?t.value=i:t.setAttribute(e,i);break;case"htmlFor":t.setAttribute("for",i);break;case"className":b(t,i);break;case"innerHTML":t.innerHTML=i;break;case"innerText":t.innerText=i;break;default:t.setAttribute(e,i)}})(t,i,r)}))},T=(e,i,s)=>{const n=document.createDocumentFragment(),l=document.createElement(e),a=e=>g(e)||t(e),h=e=>{let i;if(!a(e))return!1;g(e)?i=e:t(e)&&(i=document.createTextNode(e)),n.appendChild(i)};return r(i)?$(l,i):o(i)&&i.every((t=>a(t)))?i.forEach((t=>{h(t)})):g(i)?h(i):t(i)&&h(document.createTextNode(i)),o(s)?s.forEach((t=>{h(t)})):h(s),l.appendChild(n),l},_=t=>t*t,x=(e,r,n)=>{const o=((e=null)=>{let i,r;return e?t(e)?r=document.querySelector(e):s(e)&&(r=e):(i=document.querySelectorAll("html,body"),r=i[0].scrollTop-i[1].scrollTop>=0?i[0]:i[1]),r})(e);let l=o.scrollTop,a=0;const h=r-l,c=o.scrollHeight,u=r-c<=0?r:c,d=t=>(i(n)&&n(t),!1),f=()=>{if(a+=1,h<0){if(l-=_(a),o.scrollTop=l,l<=r)return o.scrollTop=r,d(r)}else if(l+=_(a),o.scrollTop=l,l>=u)return o.scrollTop=u,d(u);requestAnimationFrame(f)};requestAnimationFrame(f)},E=(e,i)=>{var r;let s,n=e.className;if(!n||!v(e,i))return!1;var o;s=e.classList,null!==(r=s)&&void 0!==r&&r.remove?s.remove(i):(o=n.replace(i,""),n=!!t(o)&&o.replace(/(^\s+)|(\s+$)/g,""),e.className=n)},S=t=>{let e=t.offsetTop;return null!==t.offsetParent&&(e+=S(t.offsetParent)),e},k=(t,e)=>getComputedStyle(t)[e],A=(t,e)=>{document.documentElement.style.setProperty(t,e)},w={},O=t=>y(w,t)&&w[t].length>0,C=(t,e=!0)=>e?O(t):(t=>{let e=O(t),i=t.lastIndexOf(".");for(;!e&&-1!==i;)i=(t=t.substring(0,i)).lastIndexOf("."),e=O(t);return e})(t),j=(t,i,r=!0)=>{const s=t=>{if(!O(t))return!1;w[t].forEach((t=>{const r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]","[object BigInt64Array]","[object BigUint64Array]"].indexOf(e(i))>-1?i.toString():i;t.callback.call(t.context||t,r)}))},n=()=>{let e=t,i=t.lastIndexOf(".");for(;-1!==i;)e=e.substring(0,i),i=e.lastIndexOf("."),s(e);s(t),s("*")};if(!C(t))return!1;r?setTimeout(n,10):n()},N=(()=>{let t=0;return e=>(t+=1,e?e+"-"+t:"guid-"+t)})(),I=t=>{if(!y(w,t))return!1;delete w[t]},L=(t,e)=>{if(!C(t))return!1;e?(t=>{const e=Object.keys(w);if(!t||e.length<1)return!1;e.forEach((e=>{const i=w[e];let r;i.forEach(((e,s)=>{e.callback!==t&&e.token!==t||(r=e.topic,i.splice(-1,s))})),i.length<1&&I(r)}))})(e):I(t)};class q{constructor(t){this.name="component",this.attrs={},t&&this.initialize(t)}initialize(t){return this.attr(t).render().addListeners(),this}attr(e,i){const s=this.attrs;return t(e)?i&&y(s,e)?(s[e]=i,this):s[e]:r(e)?(n=s,o=e,Object.keys(o).forEach((t=>{y(o,t)&&(n[t]=o[t])})),this):0===arguments.length?s:this;var n,o}render(){return this}refresh(){return this}destroy(){return this.removeListeners(),this}reload(t){let e=this.attr();return t&&(e=this.attr(t)),this.destroy().initialize(e),this}$emit(t,e){return j(t,e),this}$on(t,e){return((t,e,r=null)=>{const s=N();let n="symbol"==typeof t?t.toString():t;i(e)&&(w[n]||(w[n]=[]),w[n].push({topic:n,callback:e,context:r,token:s}))})(t,e,this),this}$off(t,e){return L(t,e),this}addListeners(){return this}removeListeners(){return this}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=Array(e);i<e;i++)r[i]=t[i];return r}function F(t){return function(t){if(Array.isArray(t))return z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?z(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}const H=[];let D,R;function M(t){for(;t.timeRemaining()>0&&H.length;){const t=H.shift();if(!i(t))return!1;t()}H.length?D=requestIdleCallback(M):(D=0,i(R)&&(R(),R=null))}void 0===window.requestIdleCallback&&(window.requestIdleCallback=function(t){const e=Date.now();return n((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})}),10)},window.cancelIdleCallback=function(t){clearTimeout(t)});const P=(t,e=null)=>{H.push(t),i(e)&&(R=e),D||requestIdleCallback(M)},U=(t,e,i=!1)=>{const r=e.length,s=function(t,e,i){if(e&&!Array.isArray(e)&&"number"==typeof e.length){var r=e.length;return z(e,void 0!==i&&i<r?i:r)}return t(e,i)}(F,e),n=e=>{const r=e=>t.querySelector(`#${e}`);e.forEach((e=>{const s=e.pid,n=e.id,o=e.code,l=e.rel,a=[],h=T("span",{className:"outline-navigator__text"},e.text);let c,u,d,f,m;i&&(u=T("span",{className:"outline-navigator__code","data-id":n},e.code),a.push(u)),a.push(h);const p={id:`chapter__anchor-${n}`,className:"outline-navigator__anchor",href:"#"+l,rel:l,"data-id":n};i&&(p["data-code"]=o),c=T("a",p,a);const g={id:`chapter-${n}`,className:"outline-navigator__item","data-id":n};i&&(g["data-code"]=o),d=T("li",g,c),-1===s?t.appendChild(d):(m=r(`chapter-${s}`),f=r(`subject-${s}`),f?f.appendChild(d):(f=T("ul",{id:"subject-"+s,className:"outline-navigator__subject"},d),m.appendChild(f)))}))};if(r>400)for(n(s.splice(0,400));s.length>0;){const t=s.splice(0,400);P((()=>{n(t)}))}else n(s)},W="outline-navigator_hidden",B="outline-navigator_expanded",Y="outline-navigator_folded";class G extends q{constructor(t){super(),this.name="navigator",this._default(),this.scrollTimer=null,this.resizeTimer=null,this.observerTimer=null,this.Observer=null,t&&this.initialize(t)}_default(){return this.attrs=l(G.DEFAULTS),this.$el=null,this.$title=null,this.$main=null,this.$list=null,this.$placeholder=null,this.$parentElement=null,this.$scrollElement=null,this.$active=null,this.chapters=[],this.active=0,this.offsetWidth=0,this.offsetTop=0,this.playing=!1,this.closed=!1,this}initialize(e){let r,n,o,l;return this.attr(e),r=this.attr("created"),n=this.attr("parentElement"),o=this.attr("scrollElement"),t(n)?l=document.querySelector(n):s(n)&&(l=n),this.$parentElement=l,this.$scrollElement=((e=null)=>{let i,r;return e?t(e)?r=document.querySelector(e):s(e)&&(r=e):(i=document.querySelectorAll("html,body"),r=i[0].scrollTop-i[1].scrollTop>=0?i[0]:i[1]),r})(o),this.chapters=this.attr("chapters"),this.closed=this.attr("closed"),this.active=this.attr("active"),i(r)&&r.call(this),this.chapters.length<1||(this.render().addListeners(),this.$active=document.querySelector(`#chapter-${this.active}`)),this}isClosed(){return this.closed}isSticky(){return"sticky"===this.attr("position")}isFixed(){return"fixed"===this.attr("position")}isInside(){return this.isFixed()||this.isSticky()}isOutside(){return!this.isInside()}count(){return this.chapters.length}_paintEdge(){const t=document.createDocumentFragment(),e=this.attr("title"),i=this.attr("animationCurrent"),r=this.attr("customClass"),s=this.$parentElement,n=[],o=[];let l,a,h,c,u=null;return s?(this.isInside()&&e&&(u=T("h2",{className:"outline-navigator__title"},e),this.$title=u,o.push(u)),h=T("ul",{className:"outline-navigator__list"}),this.$list=h,n.push(h),i&&(c=T("div",{className:"outline-navigator__placeholder"}),this.$placeholder=c,n.push(c)),a=T("div",{className:"outline-navigator__main"},n),this.$main=a,o.push(a),l=T("nav",{id:"outline-navigator",className:`outline-navigator ${W}`},o),this.$el=l,this.isSticky()&&(this.calculateStickyHeight(),b(l,"outline-navigator_sticky")),r&&b(l,r),t.appendChild(l),s.appendChild(t),this):this}render(){const t=this.attr("mounted"),e=this.$parentElement,r=this.chapters,s=this.count();let o;return!e||r.length<1||(this.isInside()&&b(e,"outline-navigator-parent"),this._paintEdge(),o=this.$el,this._paint(r),n((()=>{this.highlight(this.active)}),60),this.offsetTop=S(o),this.offsetWidth=o.offsetWidth,this.isFixed()&&(this.sticky(),A("--outline-navigator-width",`${this.offsetWidth}px`)),i(t)&&t.call(this),s<400&&this.onObserver()),this}erase(){return this.$list.innerHTML="",this}_paint(t){const e=this.attr("showCode"),i=this.$el,r=this.$list;return U(r,t,e),E(i,W),b(i,B),this}_remove(){return this.$parentElement.removeChild(this.$el),this}refresh(t){const e=this.$el;return E(e,W),this.erase()._paint(t),this}_getPlaceholderOffset(t){const e=this.$main,i=this.$list,r=i.querySelector(".outline-navigator__anchor"),s=parseInt(k(e,"padding-top"),10),n=parseInt(k(e,"border-top-width"),10),o=parseInt(k(i,"padding-top"),10),l=parseInt(k(i,"margin-top"),10),a=parseInt(k(i,"border-top-width"),10);let h,c=0;return s&&(c+=s),o&&(c+=o),l&&(c+=l),n&&(c+=n),a&&(c+=a),h=r.offsetHeight*t,c+h}positionPlaceholder(t){const e=this.$list,i=this.$placeholder,r=e.querySelector(".outline-navigator__anchor"),s=this.attr("animationCurrent"),n=r.offsetHeight;let o=0;return s?(o=this._getPlaceholderOffset(t),i.style.cssText=`transform: translateY(${o}px);height:${n}px;`,this):this}highlight(t){const e=this.$el,i=this.attr("animationCurrent"),r="outline-navigator_active",o="outline-navigator_highlight";let l="relative"===this.attr("position")?this.$parentElement:this.$main,a=null,h=0;return e?(a=e.querySelector(`#chapter__anchor-${t}`),a?(this.active=parseInt(a.getAttribute("data-id"),10),this.$active&&(E(this.$active,o),E(this.$active,r)),this.$active=a,b(this.$active,r),i?this.positionPlaceholder(this.active):b(this.$active,o),n((()=>{((t,e)=>{let i,r,n=!1;return s(t)&&s(e)?(i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),n=!!(r.top>=i.top&&r.right<=i.right&&r.bottom<=i.bottom&&r.left>=i.left),n):n})(this.$active,l)||(h=this._getPlaceholderOffset(this.active),x(l,h))})),this):this):this}sticky(){const t=this.attr("afterSticky"),e="outline-navigator_fixed",r=this.$el,s=this.offsetTop,n=this.$scrollElement.scrollTop;let o;return this.isFixed()?(o=n>=s,o?b(r,e):E(r,e),i(t)&&t.call(this,this.isClosed(),o),this):this}calculateStickyHeight(){const t=document.documentElement,e=Math.max(t.clientHeight||0,window.innerHeight||0);return A("--outline-sticky-height",`${e}px`),this}scrollTo(t,e){const i=this.$scrollElement;return x(i,t,e),this}show(){const t=this.attr("afterOpened"),e=this.count(),r=this.$el,s=this.$parentElement;return this.isInside()?e>800?E(s,W):(E(s,W),n((()=>{E(s,Y),b(s,B)}),30)):E(r,W),this.closed=!1,i(t)&&t.call(this),this}hide(){const t=this.attr("afterClosed"),e=this.count(),r=this.$el,s=this.$parentElement;return this.isInside()?e>800?b(s,W):(b(s,Y),E(s,B),n((()=>{b(s,W)}))):b(r,W),this.closed=!0,i(t)&&t.call(this),this}toggle(){const t=this.attr("afterToggle"),e=this.offsetTop,r=this.$scrollElement.scrollTop;let s;return this.isClosed()?this.show():this.hide(),i(t)&&n((()=>{s=r>=e,t.call(this,this.isClosed(),s)})),this}destroy(){const t=this.attr("beforeDestroy"),e=this.attr("afterDestroy");return i(t)&&t.call(this),this.removeListeners()._remove()._default(),this.scrollTimer&&(clearTimeout(this.scrollTimer),this.scrollTimer=null),this.resizeTimer&&(clearTimeout(this.resizeTimer),this.resizeTimer=null),this.observerTimer&&(clearTimeout(this.observerTimer),this.observerTimer=null),this.Observer&&(this.Observer=null),i(e)&&e.call(this),this}onObserver(){const t=this.attr("selector");return this.Observer=((t,e={})=>{const r=e.root||null,n=e.selector||".outline-heading",o=e.context||null,l={rootMargin:e.rootMargin||"0px 0px -90% 0px"},a=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&i(t)&&t.call(o||e.target,e.target)}))}),l),h=s(r)?r:document;return r&&(l.root=r),h.querySelectorAll(n).forEach((t=>{a.observe(t)})),a})((t=>{const e=t.getAttribute("data-id");if(this.playing)return!1;this.observerTimer&&clearTimeout(this.observerTimer),this.observerTimer=n((()=>{this.highlight(e)}),100)}),{selector:t,context:this}),this}onSelect(t){const e=this.attr("stickyHeight"),r=t.delegateTarget,s=r.getAttribute("data-id"),o=r.href.split("#")[1],l=document.querySelector(`#${o}`),a=S(l)-(e+10),h=this.$scrollElement.scrollHeight,c=this.attr("afterScroll"),u=()=>{i(c)&&c.call(this,"chapter"),n((()=>{this.playing=!1,this.$emit("toolbar:update",{top:a,min:0,max:h})}))};return this.playing=!0,this.isFixed()?(this.sticky(),n((()=>{this.scrollTo(a,u),this.highlight(s)}),10)):(this.scrollTo(a,u),this.highlight(s)),function(t){t.stopPropagation(),t.preventDefault()}(t),this}onScroll(){const t=this.$scrollElement;return this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=n((()=>{const e=t.scrollTop,i=t.scrollHeight-t.clientHeight;this.isFixed()&&this.sticky(),this.$emit("toolbar:update",{top:e,min:0,max:i})}),100),this}onResize(){return this.isSticky()?(this.resizeTimer&&clearTimeout(this.resizeTimer),this.resizeTimer=n((()=>{this.calculateStickyHeight()})),this):this}onRefresh(t){return this.refresh(t),this}addListeners(){const t=this.$el,e=this.$scrollElement,i=e.tagName.toLowerCase();let r=e;return this.count()<1||("html"!==i&&"body"!==i||(r=window),p(t,".outline-navigator__anchor","click",this.onSelect,this,!0),d(r,"scroll",this.onScroll,this,!0),this.isSticky()&&d(window,"resize",this.onResize,this,!0),this.$on("anchors:all:paint",this.onObserver,this),this.$on("navigator:refresh",this.onRefresh,this)),this}removeListeners(){const t=this.attr("selector"),e=this.$el,i=this.$scrollElement,r=i.tagName.toLowerCase();let s=i;return this.count()<1||("html"!==r&&"body"!==r||(s=window),u(e,"click",this.onSelect),u(s,"scroll",this.onScroll),this.isSticky()&&u(window,"resize",this.onResize),this.$off("anchors:all:paint"),this.$off("navigator:refresh"),this.Observer&&document.querySelectorAll(t).forEach((t=>{this.Observer.unobserve(t)}))),this}}return G.DEFAULTS=l({parentElement:"",scrollElement:"",selector:".outline-heading",active:0,closed:!1,showCode:!0,animationCurrent:!0,position:"relative",stickyHeight:0,chapters:[],created:null,mounted:null,afterClosed:null,afterOpened:null,afterScroll:null,beforeDestroy:null,afterDestroy:null,afterSticky:null}),G}));
//# sourceMappingURL=navigator.min.js.map
